## S04 - STRIDE Matrix

| Element                              | Data/Boundary                        | Threat (S/T/R/I/D/E) | Description (1-2 строки)                                                | NFR link (ID)                           | Mitigation idea (ADR later)                       |
| ------------------------------------ | ------------------------------------ | -------------------- | ------------------------------------------------------------------------ | --------------------------------------- | ------------------------------------------------- |
| Edge: Internet → API (auth/login)    | JWT / credentials / public endpoint  | S                    | Кража/повтор токенов, brute-force логина                                  | NFR-202, NFR-305, NFR-101               | MFA, short JWT TTL + refresh, auth rate limits    |
| Edge: Internet → API (order submission)| DTO / order input                     | T                    | Подмена/манипуляция полей заказа (точки, цена, destination)               | NFR-206, NFR-205, NFR-302               | Strict input validation, server-side canonicalization |
| Edge: Internet → API (mass requests)  | requests / public API                 | D                    | Массовые запросы → перегрузка / DoS                                        | NFR-201, NFR-101, NFR-301               | Global + per-user rate limits, quotas, backpressure |
| Node: API Gateway/Controller         | Routing / logging / errors            | R                    | Нет/неполный аудит действий → спорные операции неотслеживаемы             | NFR-105, NFR-304                        | RFC7807 errors, correlation_id in logs, audit events |
| Edge: API → Service (DTO/requests)   | DTO / internal calls                  | T/I                  | Некорректные DTO/неканоничные поля приводят к логическим ошибкам/утечкам   | NFR-206, NFR-205, NFR-103               | Input schema validation, canonicalization, reject extra fields |
| Node: Service / Business logic       | Order processing / payments           | E/T                  | Эскалация привилегий через уязвимость в логике (создание/подмена ролей)    | NFR-202, NFR-205                        | RBAC checks, principle of least privilege, server-side checks |
| Edge: Service → Database (SQL/ORM)   | SQL/ORM / PII storage                 | T/I                  | SQL injection или запись неканоничных данных                              | NFR-205, NFR-306, NFR-103               | Parametrized queries, ORM best practices, DB constraints |
| Node: Database (storage)             | Persisted orders / profiles (PII)     | I                    | Доступ к PII/утечка из-за неправильных прав или бэкапа                    | NFR-103, NFR-303                        | Encryption at rest, access controls, retention policy ≤7d |
| Edge: Service → External Provider    | HTTP/gRPC calls to taxi provider      | D                    | Залипание/долгие ответы внешнего провайдера → деградация сервиса          | NFR-102, NFR-104                        | Timeouts ≤2s, retry with jitter, circuit-breaker |
| Edge: Service → Driver App (notify)  | Notifications (push/SMS/email)        | I/D                  | Утечка PII в уведомлениях; спам-авторы могут злоупотреблять отправкой      | NFR-101, NFR-103, NFR-104               | Rate-limit notifications, redact PII in messages, delivery status logging |
| Edge: API → Client (responses/errors) | API responses (errors / payloads)     | I/R                  | Подробные стэктрейсы в ошибках раскрывают внутреннюю структуру сервиса     | NFR-105, NFR-304                        | Hide stack traces, use RFC7807, include correlation_id only |
| Node: Logs / Observability           | Logs containing events / traces        | I/R                  | Логи содержат сырой PII или слишком подробные данные                       | NFR-103, NFR-105                        | PII masking, redact sensitive fields, log retention policy |
| Node: Service → Queue (optional)     | Events / async jobs                    | D/T                  | Очередь может быть заспамлена/подделана сообщение → DoS / tampering        | NFR-201, NFR-206                        | Authenticated producers, rate limits, message integrity (signatures) |
| Edge: Client device (lost/stolen)    | Stored tokens / cached PII on device   | S/I                  | Кража устройства → доступ к токенам/PII                                   | NFR-305, NFR-103                        | Short token TTL, device binding, remote session invalidation |
| Node: Admin operations               | Admin API / audit actions              | R/E                  | Отсутствие неизменяемого аудита → отказ в доказательствах; повышение прав   | NFR-105, NFR-302, NFR-303               | Immutable audit log, admin RBAC, approval workflows |
| Edge: Service → Message Queue | MQ messages / async jobs | D/I | Несанкционированный доступ или перегрузка очереди сообщений → потеря данных/отказ сервиса | NFR-102, NFR-104, NFR-301 | TLS-шифрование, аутентификация клиентов, квоты на сообщения | 
| Edge: Client → Service (GPS) | GPS coordinates / requests | T | Подделка геолокационных данных → мошенничество с маршрутами и расчетами стоимости | NFR-302, NFR-206 | Гео-ограждения, детекция аномалий, проверка доверенных устройств |
